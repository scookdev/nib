#!/bin/bash
#
# Start a repl for the given container
#
#/* vim: set filetype=sh : */

IRBRC="
require \"rubygems\"
require \"irb/completion\"
require \"irb/ext/save-history\"

# irb configuration
IRB.conf[:PROMPT_MODE] = :SIMPLE
IRB.conf[:AUTO_INDENT] = true

# irb history
IRB.conf[:EVAL_HISTORY] = 10
IRB.conf[:SAVE_HISTORY] = 1000
IRB.conf[:HISTORY_FILE] = \"/usr/src/app/tmp/irb_history\"
"

PRYRC="
Pry.config.history.file = \"/usr/src/app/tmp/irb_history\"
"

SCRIPT="
  echo '${IRBRC}' > /root/.irbrc
  echo '${PRYRC}' > /root/.pryrc

  has_pry=false
  has_boot=false

  if hash pry 2>/dev/null ; then
    has_pry=true
  fi

  if [ -f config/boot.rb ]; then
    has_boot=true
  fi

  if [ -f bin/console ]; then
    bin/console
  elif hash rails 2>/dev/null ; then
    rails console
  elif [ \"\$has_boot\" = true ] && [ \"\$has_pry\" = true ]; then
    pry -r ./config/boot
  elif [ \"\$has_boot\" = true ]; then
    irb -r ./config/boot
  elif [ \"\$has_pry\" = true ]; then
    bundle config console pry
    bundle console
  else
    bundle console
  fi
"

source "/usr/local/bin/_tty"
